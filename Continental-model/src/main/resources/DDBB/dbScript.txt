-- public.clients definition

-- Drop table

-- DROP TABLE public.clients;

CREATE TABLE public.clients (
	idclient int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"document" varchar(20) NOT NULL,
	"name" varchar(100) NOT NULL,
	countrycode varchar(2) NOT NULL,
	clientdowndate date NULL,
	CONSTRAINT clients_pkey PRIMARY KEY (idclient)
);


-- public.criteria definition

-- Drop table

-- DROP TABLE public.criteria;

CREATE TABLE public.criteria (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" varchar(255) NOT NULL,
	description text NULL,
	multiplier numeric NULL,
	"type" varchar(255) NULL,
	date_condition text NULL,
	CONSTRAINT criteria_pkey PRIMARY KEY (id)
);


-- public.hotels definition

-- Drop table

-- DROP TABLE public.hotels;

CREATE TABLE public.hotels (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" varchar(255) NOT NULL,
	address varchar(255) NOT NULL,
	hoteldowndate date NULL,
	CONSTRAINT hoteles_pkey PRIMARY KEY (id)
);


-- public.products definition

-- Drop table

-- DROP TABLE public.products;

CREATE TABLE public.products (
	productid int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" varchar(255) NULL,
	price float8 NULL,
	CONSTRAINT products_pkey PRIMARY KEY (productid)
);


-- public.roomtype definition

-- Drop table

-- DROP TABLE public.roomtype;

CREATE TABLE public.roomtype (
	typeid int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"type" varchar NULL,
	price float8 NULL,
	CONSTRAINT roomtype_pkey PRIMARY KEY (typeid)
);


-- public.trole definition

-- Drop table

-- DROP TABLE public.trole;

CREATE TABLE public.trole (
	id_rolename int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	rolename varchar(255) NULL,
	xmlclientpermission varchar(10485760) NULL,
	CONSTRAINT trole_pkey PRIMARY KEY (id_rolename)
);


-- public.tserver_permission definition

-- Drop table

-- DROP TABLE public.tserver_permission;

CREATE TABLE public.tserver_permission (
	id_server_permission int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	permission_name varchar(10485760) NULL,
	CONSTRAINT tserver_permission_pkey PRIMARY KEY (id_server_permission)
);


-- public.tuser definition

-- Drop table

-- DROP TABLE public.tuser;

CREATE TABLE public.tuser (
	user_ varchar(50) NOT NULL,
	"password" varchar(50) NULL,
	"name" varchar(50) NULL,
	surname varchar(50) NULL,
	email varchar(50) NULL,
	nif varchar(50) NULL,
	lastpasswordupdate timestamp NULL DEFAULT CURRENT_TIMESTAMP,
	firstlogin bool NULL DEFAULT true,
	user_down_date varchar NULL,
	CONSTRAINT tuser_pkey PRIMARY KEY (user_)
);


-- public.accesscards definition

-- Drop table

-- DROP TABLE public.accesscards;

CREATE TABLE public.accesscards (
	accesscardid int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	hotelid int4 NULL,
	available bool NULL DEFAULT true,
	carddowndate date NULL,
	CONSTRAINT accesscards_pkey PRIMARY KEY (accesscardid),
	CONSTRAINT fk_accesscards_hotels FOREIGN KEY (hotelid) REFERENCES public.hotels(id)
);


-- public.employees definition

-- Drop table

-- DROP TABLE public.employees;

CREATE TABLE public.employees (
	employeeid int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"document" varchar(255) NULL,
	"name" varchar(255) NULL,
	hotelid int4 NULL,
	employeedowndate date NULL,
	CONSTRAINT employees_pkey PRIMARY KEY (employeeid),
	CONSTRAINT employees_hotelid_fkey FOREIGN KEY (hotelid) REFERENCES public.hotels(id)
);


-- public.parkings definition

-- Drop table

-- DROP TABLE public.parkings;

CREATE TABLE public.parkings (
	id_parking int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	id_hotel int4 NULL,
	total_capacity int4 NULL,
	occupied_capacity int4 NULL,
	description text NULL,
	price numeric(10, 2) NULL,
	CONSTRAINT parkings_pkey PRIMARY KEY (id_parking),
	CONSTRAINT parkings_id_hotel_fkey FOREIGN KEY (id_hotel) REFERENCES public.hotels(id)
);


-- public.rooms definition

-- Drop table

-- DROP TABLE public.rooms;

CREATE TABLE public.rooms (
	roomid int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	hotelid int4 NOT NULL,
	roomnumber int4 NOT NULL,
	roomdowndate date NULL,
	typeroomid int4 NULL,
	CONSTRAINT habitaciones_pkey PRIMARY KEY (roomid),
	CONSTRAINT habitaciones_idhotel_fkey FOREIGN KEY (hotelid) REFERENCES public.hotels(id),
	CONSTRAINT rooms_fk FOREIGN KEY (typeroomid) REFERENCES public.roomtype(typeid)
);


-- public.seasons definition

-- Drop table

-- DROP TABLE public.seasons;

CREATE TABLE public.seasons (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	criteria_id int4 NOT NULL,
	start_day int4 NOT NULL,
	start_month int4 NOT NULL,
	end_day int4 NOT NULL,
	end_month int4 NOT NULL,
	CONSTRAINT seasons_pkey PRIMARY KEY (id),
	CONSTRAINT seasons_criteria_id_fkey FOREIGN KEY (criteria_id) REFERENCES public.criteria(id)
);


-- public.trole_server_permission definition

-- Drop table

-- DROP TABLE public.trole_server_permission;

CREATE TABLE public.trole_server_permission (
	id_role_server_permission int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	id_rolename int4 NULL,
	id_server_permission int4 NULL,
	CONSTRAINT trole_server_permission_pkey PRIMARY KEY (id_role_server_permission),
	CONSTRAINT fk_trole_server_permission FOREIGN KEY (id_rolename) REFERENCES public.trole(id_rolename) ON DELETE CASCADE,
	CONSTRAINT fk_tserver_permission FOREIGN KEY (id_server_permission) REFERENCES public.tserver_permission(id_server_permission)
);


-- public.tuser_role definition

-- Drop table

-- DROP TABLE public.tuser_role;

CREATE TABLE public.tuser_role (
	id_user_role int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	id_rolename int4 NULL,
	user_ varchar(50) NULL,
	CONSTRAINT tuser_role_pkey PRIMARY KEY (id_user_role),
	CONSTRAINT fk_trole FOREIGN KEY (id_rolename) REFERENCES public.trole(id_rolename) ON DELETE CASCADE,
	CONSTRAINT fk_tuser FOREIGN KEY (user_) REFERENCES public.tuser(user_)
);


-- public.bookings definition

-- Drop table

-- DROP TABLE public.bookings;

CREATE TABLE public.bookings (
	bookingid int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	roomid int4 NOT NULL,
	initialdate date NOT NULL,
	enddate date NOT NULL,
	clientid int4 NOT NULL,
	checkindatetime timestamp NULL,
	checkoutdatetime timestamp NULL,
	price numeric NULL,
	CONSTRAINT reservas_pkey PRIMARY KEY (bookingid),
	CONSTRAINT bookings_clientid_fkey FOREIGN KEY (clientid) REFERENCES public.clients(idclient),
	CONSTRAINT reservas_idhabitacion_fkey FOREIGN KEY (roomid) REFERENCES public.rooms(roomid) ON DELETE CASCADE ON UPDATE CASCADE
);


-- public.extraexpenses definition

-- Drop table

-- DROP TABLE public.extraexpenses;

CREATE TABLE public.extraexpenses (
	idexpense int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	bookingid int4 NULL,
	concept varchar NULL,
	price float8 NULL,
	CONSTRAINT extraexpenses_pkey PRIMARY KEY (idexpense),
	CONSTRAINT extraexpenses_fk FOREIGN KEY (bookingid) REFERENCES public.bookings(bookingid)
);


-- public.parkinghistory definition

-- Drop table

-- DROP TABLE public.parkinghistory;

CREATE TABLE public.parkinghistory (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	id_parking int4 NULL,
	id_booking int4 NULL,
	entry_date date NULL,
	exit_date date NULL,
	CONSTRAINT parkinghistory_pkey PRIMARY KEY (id),
	CONSTRAINT parkinghistory_id_booking_fkey FOREIGN KEY (id_booking) REFERENCES public.bookings(bookingid),
	CONSTRAINT parkinghistory_id_parking_fkey FOREIGN KEY (id_parking) REFERENCES public.parkings(id_parking)
);


-- public.refrigerators definition

-- Drop table

-- DROP TABLE public.refrigerators;

CREATE TABLE public.refrigerators (
	fridge_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	room_id int4 NULL,
	capacity int4 NULL,
	CONSTRAINT refrigerators_pkey PRIMARY KEY (fridge_id),
	CONSTRAINT refrigerators_room_id_fkey FOREIGN KEY (room_id) REFERENCES public.rooms(roomid)
);


-- public.accesscard_booking definition

-- Drop table

-- DROP TABLE public.accesscard_booking;

CREATE TABLE public.accesscard_booking (
	accesscardasignment int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	accesscardid int4 NULL,
	bookingid int4 NULL,
	CONSTRAINT accesscard_booking_pkey PRIMARY KEY (accesscardasignment),
	CONSTRAINT accesscard_booking_accesscardid_fkey FOREIGN KEY (accesscardid) REFERENCES public.accesscards(accesscardid),
	CONSTRAINT accesscard_booking_bookingid_fkey FOREIGN KEY (bookingid) REFERENCES public.bookings(bookingid)
);


-- public.refrigerator_stock definition

-- Drop table

-- DROP TABLE public.refrigerator_stock;

CREATE TABLE public.refrigerator_stock (
	stock_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	refrigeratorid int4 NULL,
	productid int4 NULL,
	stock int4 NULL,
	CONSTRAINT refrigerator_stock_pkey PRIMARY KEY (stock_id),
	CONSTRAINT refrigerator_stock_fk FOREIGN KEY (refrigeratorid) REFERENCES public.refrigerators(fridge_id),
	CONSTRAINT refrigerator_stock_fk_1 FOREIGN KEY (productid) REFERENCES public.products(productid)
);